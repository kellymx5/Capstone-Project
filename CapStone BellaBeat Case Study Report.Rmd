---
title: "CapStone BellaBeat Case Study Report"
author: "MIke Kelly"
date: "2022-08-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
```

## CapStone Project - BellaBeat Case Study Analysis
### 1. Summary
BellaBeat is an American health-focused, consumer electronics company. It produces wearable devices and software apps designed specifically for women to collect data on activity, sleep, stress, and reproductive health. The goal of Bellabeat's products is to empower women with knowledge about their own health and habits. 

Bellabeat is a successful small company and would like to improve their position in the global smart device market. Urška Sršen, cofounder and Chief Creative Officer of Bellabeat, would like to analyze smart device fitness data from non-Bellabeat products to help identify new growth opportunities for the company. 

### 2. Business Task 
Identify trends from non-Bellabeat smart devices data and apply insights into Bellabeat’s marketing strategy.

#### 2.1 Stakeholders
* Urška Sršen - Bellabeat cofounder and Chief Creative Officer
* Sando Mur - Bellabeat cofounder and key member of Bellabeat executive team
* Bellabeat Marketing Analytics team

#### 2.2 Related Products
* Bellabeat app: Provides users with health data related to their activity, sleep, stress,
menstrual cycle, and mindfulness habits. The Bellabeat app connects to their line of smart wellness products.
* Leaf: Bellabeat’s classic wellness tracker that can be worn as a bracelet, necklace, or clip. 
* Time: BellaBeat's wellness watch tracker that combines the timeless look of a classic timepiece with embedded smart technology. 

### 3 Data


#### 3.1 DataSet
The data source used for this analysis is FitBit Fitness Tracker Data stored in Kaggle and made available through Mobius.

#### 3.2 Information about dataset
The datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty three Fitbit users consented to the submission of personal tracker data, which includes minute-level output for physical activity, heart rate, and sleep monitoring. Variation between datasets represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.

#### 3.2.1 Provenance
* Title - Crowd-sourced Fitbit datasets 03.12.2016-05.12.2016
* Location - https://zenodo.org/record/53894#.X9oeh3Uzaao

#### 3.3 Accessibility and privacy of data 
The dataset metadata confirms it is open-source. The owner has placed it into public domain under copyright law and the dataset can be copy, modify and distribute, all without asking permission.

#### 3.4 Data Organization
Dataset is available as one .zip file. The container file consists of 18 CSV documents. The CSV documents are summarized below:  


```{r echo=FALSE}
Table <- c("dailyActivity_merged", "dailyCalories_merged", "dailyIntensities_merged", "dailySteps_merged", "heartrate_seconds_merged", "hourlyCalories_merged", "hourlyIntensities_merged", "hourlySteps_merged", "minuteCaloriesWide_merged", "minuteIntensitiesNarrow_merged", "minuteIntensitiesWide_merged", "minuteMETsNarrow_merged", "minuteSleep_merged", "minuteStepsNarrow_merged", "minuteStepsWide_merged", "sleepDay_merged", "weightLogInfo_merged")
Description <- c("Daily Activity over 31 days of 33 users. Tracking daily: Steps, Distance, Intensities, Calories", "Daily Calories over 31 days of 33 users",
"Daily Intensity over 31 days of 33 users. Measured in Minutes and Distance, dividing groups in 4 categories: Sedentary, Lightly Active, Fairly Active,Very Active", "Daily Steps over 31 days of 33 users", "Exact day and time heartrate logs for 7 users", "Hourly Calories burned over 31 days of 33 users",
"Hourly total and average intensity over 31 days of 33 users", "Hourly Steps over 31 days of 33 users", "Calories burned every minute over 31 days of 33 users (Every minute in single column)", "Intensity counted by minute over 31 days of 33 users (Every minute in single row)", "Intensity counted by minute over 31 days of 33 users (Every minute in single column)", "Ratio of the energy you are using in a physical activity compared to the energy you would use at rest. Counted in minutes", "Log Sleep by Minute for 24 users over 31 days. Value column not specified", "Steps tracked every minute over 31 days of 33 users (Every minute in single row)", "Steps tracked every minute over 31 days of 33 users (Every minute in single column)", "Daily sleep logs, tracked by: Total count of sleeps a day, Total minutes, Total Time in Bed", "Weight track by day in Kg and Pounds over 30 days. Calculation of BMI. Variable for weight manually logged.In total there are 8 users")
csv_table <- cbind(Table, Description)
kable(csv_table)
```

Each CVS document contains merged data from surveyed participants where each participant has a unique ID followed by associated data tracked by either time or day. 



### 4 Data Processing
Data cleaning, formatting, and data analysis will be done using R.

#### 4.1 Load Working Environment
* The following R libraries will be loaded:
  + tidyverse
  + here
  + skimr
  + janitor
  + lubridate
  + ggpubr
  + knitr
  + kableExtra
  + tibble
  + tidyr
```{r include=FALSE}
library(tidyverse)
library(here)
library(skimr)
library(janitor)
library(lubridate)
library(ggpubr)
library(knitr)
library(kableExtra)
```

#### 4.2 Applied DataSets 
* For this case study, the following datasets will be used
  + dailyActivity_merged.csv
  + weightLogInfo_merged.csv
```{r include=FALSE}
daily_activity <- read_csv(file= "dailyActivity_merged.csv")
weight_log <- read_csv(file= "weightLogInfo_merged.csv")

head(daily_activity)
str(daily_activity)

head(weight_log)
str(weight_log)
```


#### 4.3 Check, Clean and Format Data
For consistency, we will check the number of unique Participants Id values and check for duplicate rows.
We will then clean and format label names. 
```{r}
##### Check, Clean and Format  Data
###### Check for number unique Id (users)
n_unique(daily_activity$Id)
n_unique(weight_log$Id)
```

```{r}
###### Check for any duplicate rows
sum(duplicated(daily_activity))
sum(duplicated(weight_log))
```

```{r}
###### Clean and Rename Columns 
daily_activity <- clean_names(daily_activity)
weight_log <- clean_names(weight_log)
```

#### 4.4 Convert and Format Date from Chr to Date format
Rename column name activity_date to date for consistency, then convert date values from Chr to Date format.
```{r}
daily_activity <- daily_activity %>%
  rename(date = activity_date) %>%
  mutate(date = as_date(date, format = "%m/%d/%Y"))
weight_log <- weight_log %>%
  mutate(date = as_date(date, format = "%m/%d/%Y"))
head(daily_activity)
```

#### 4.5  Merge Datasets
Merge datasets daily_activity and weight_log together using an inner join.
Then check the new dataset for the correct size
```{r}
daily_activity_and_weight_log <- merge(daily_activity, weight_log, by=c ("id", "date"))
```
```{r}
#### Check merge and dataset size 
glimpse(daily_activity_and_weight_log)
n_unique(weight_log$id)
n_unique(daily_activity_and_weight_log$id)
```

### 5. Data Analysis
We will analyze trends from surveyed users FitBit data to determine insights that may better direct BellaBeat's marketing strategy. Specifically, we will look at general user data (from daily_activit.csv) consisting of data from all participants and data from participants who provided weight and BMI data (from weight_log.cvs).

**The total number of surveyed participants was 33.**  
**The total number of participants with weight data was 8.**

Analysis will be done using data from the eight participants in the weight_log dataset.

#### 5.1 Determine Change in Recorded Weight for Each Participant
First, we calculated the change in recorded weight during the survey period.
This was accomplished by subtracting the last recorded weight from the first.
If the participant only provided one weight recording, the weight change is listed as zero.

```{r}
df <- daily_activity_and_weight_log %>%
  select(id, weight_pounds) %>%
  group_by(id) %>%
  filter(row_number() == 1 | row_number() == n())
# print(df)

#### This works...
#df$first_last <- rep(c("first", "last"), times = nrow(df)/2) 
#df1 <- df %>% pivot_wider(names_from = first_last, values_from = weight_pounds) 
#df2 <- mutate(df1, weight_lost = (first - last))
#df2 <- select(df2, id, weight_lost) 
#df2[is.na(df2)] <- 0
#print(df2)


######### lets add pipes
df$first_last <- rep(c("first", "last"), times = nrow(df)/2) 
weight_change <- df %>% pivot_wider(names_from = first_last, values_from = weight_pounds) %>%
  mutate(weight_changed = (last - first)) 
  
weight_change <- select(weight_change, id, weight_changed) 
weight_change[is.na(weight_change)] <- 0
# print(weight_change)
```

#### 5.2 Determine the number of days between the first and last weighting
Next, we want to determine the number of days between the first and last recorded weights.
This will allow us to determine the time period for any changes in weight.
```{r}
####### df3 = list of id with alternating first and last recorded date weights.
df3 <- daily_activity_and_weight_log %>%
  select(id, date) %>%
  group_by(id) %>%
  filter(row_number() == 1 | row_number() == n()) %>% #### problem here with single ID values
  arrange(id, date)
  
####### Issue fixed with a fudge - id's 2 and 6 have only one weight / time measurement. 9/2/22
### Create a dummy array and set to duplicate the single weighted entry so math works.
### Then in idx, using duptimes, repeat each line duptimes.
### df3 then contains correct number of entry with lines 2 and 6 repeated twice.
duptimes <- c(1,1,2,1,1,1,1,1,1,2,1,1,1,1)
# Create an index of the rows you want with duplication
 idx <- rep(1:nrow(df3), duptimes)
# Use that index to generate your new data frame
 df3 <- df3[idx,]
 #print(df3)

df3$first_last <- rep(c("first1", "last1"), times = nrow(df3)/2) 
days_between_weighting <- df3 %>% pivot_wider(names_from = first_last, values_from = date) %>%
  mutate(days = abs(last1 - first1))
days_between_weighting <- select(days_between_weighting, id, days)
days_between_weighting$days[is.na(days_between_weighting$days)] <- 0 #replace NA with 0
days_between_weighting$days <- as.numeric(days_between_weighting$days)

# print(days_between_weighting)

weight_change_id <- merge(weight_change, days_between_weighting, by = "id") 
weight_change_id$days <- as.numeric(weight_change_id$days)
weight_change_id$l1 <- factor(weight_change_id$id, levels = c(weight_change_id$id),labels = c(1:8)) # Add ID code column
```

#### 5.3 Determine Frequency of Weight Measurements
We determined the number of logged weight measurements for each participant.
This will allow us to determine how often a weight was recorded in relation to the total days in the survey.
```{r}
times_weighted <- daily_activity_and_weight_log %>%
  select(id, weight_pounds) %>%
  group_by(id) %>% summarise(times_weight = n())
# print(times_weighted)
```

#### 5.4 Calculate the Mean Calories expended, Mean Weight, and Mean BMI for each participant
We will calculate the mean value for the calories expended, daily recorded weight, and BMI - over the survey period. This will allow us to understand the relationship between a change in weight, BMI, and calorie expenditure.
A certain amount of error may be introduced as the recorded weight and BMI values may be less than the total calorie values.
```{r}
calories_id <- daily_activity_and_weight_log %>%
  group_by(id) %>%
  summarise(calories = mean(calories, na.rm=TRUE))

weight_id <- daily_activity_and_weight_log %>%
  group_by(id) %>%
  summarise(weight = mean(weight_pounds, na.rm=TRUE))

bmi_id <- daily_activity_and_weight_log %>%
  group_by(id) %>%
  summarise(bmi = mean(bmi, na.rm=TRUE))

```

#### 5.4.1 Calculate Weight Statistics for each Participant
We will also calculate weight statistics including: Min, Max and standard deviation.
```{r echo=TRUE}
#### Calculate Weight Statistics for each Participant ####
#### Change NA values to 0 ####
#### Add L1 ID code and move it to first column, remove ID column         ####
weight_summary <- weight_log %>%
  group_by(id) %>%
  summarise(min = min(weight_pounds, na.rm=TRUE), 
            mean = mean(weight_pounds, na.rm =TRUE),
            max = max(weight_pounds, na.rm =TRUE),
            sd = sd(weight_pounds, na.rm =TRUE)            ) 
weight_summary[is.na(weight_summary)] <- 0
weight_summary$l1 <- factor(weight_summary$id, levels = c(weight_summary$id),
                            labels = c(1:8)) 
weight_summary <- weight_summary %>% relocate(l1, .before = id)
weight_summary <- subset (weight_summary, select = -id)


```

#### 5.5 Merge Weight_Change and Calories Data for Visualization
A new dataset, “total” will be created to contain participant weight, BMI, and expended calorie values.

```{r}
# total <- merge(weight_change_id, calories_id,by="id")
total <- merge(weight_change_id, bmi_id,by="id")
total <- merge(weight_change_id, weight_id,by="id")
```
#### 5.6 Determine Average Time each Participant Worn Smart Device each Day
The Daily_Activity dataset provides data on participant activity levels for every minute the smart device was worn.
This data is segmented into four groups: Very Active, Fairly Active, Slightly Active, and Sedentary. Each segment was summed and then averaged over the total days in the participant sample.

```{r}

######## determine the average time (in hours) each participant wore their device
# determine total time per day device was worn (active).
# not the cleanest code but it works...

#ti <- c(daily_activity$very_active_minutes + daily_activity$fairly_active_minutes+ # This code is not used
#          daily_activity$lightly_active_minutes + daily_activity$sedentary_minutes)# delete

# Only minutes_worn_percents$total_m and total_worn are used to create total_precents in minutes_worn_precents 
# minutes_worn_precents$total_precent and l1 are plotted. - 9/13/22
minutes_worn <- daily_activity %>% 
  mutate(total_minutes_worn = very_active_minutes + fairly_active_minutes + 
           lightly_active_minutes + sedentary_minutes)%>%
  mutate (percent_minutes_worn = (total_minutes_worn/1440)*100) 
# print(minutes_worn$total_minutes_worn)

minutes_worn_percent <- minutes_worn%>% 
  group_by(id) %>%  summarise(total_m = sum(total_minutes_worn)) %>%
  mutate(totals = n()) # %>%
# print(minutes_worn_percent)

minutes_worn_percents <- minutes_worn%>%
   group_by(id) %>%   summarise(total_worn = n()) %>%
    mutate(totals = sum(total_worn)) %>%
  mutate(total_precents = (minutes_worn_percent$total_m / total_worn)/60)
 # print(minutes_worn_percents)

# Reduce minutes_worn_precents to Ids in weight_logged group
# Add Id reference codes (l1) 
time_worn_weight_log <- merge(minutes_worn_percents, times_weighted, by=c ("id"))
minutes_worn_percents$l1 <- factor(minutes_worn_percents$id, levels = c(minutes_worn_percents$id),labels = c(1:33))
time_worn_weight_log$l1 <- factor(time_worn_weight_log$id, levels = c(weight_change_id$id),labels = c(1:8))
```


#### 5.7 Retrieve and Calculate Mean BMI and Weight
 From our merged dataset containing daily_activity and weight_log data, we will extract and summarize the mean calories # 
 expended, mean BMI and mean weight for each participant.  
```{r}
# *Note: This is redundant code as this process was preformed earlier in section 5.5. A new dataset “df4” is created.
# During the project cleanup phase this code will be removed and updated in the visualization code, “df4” will be replaced with # “total” where appropriate.*   9/13/22

 calories_id <- daily_activity_and_weight_log %>%
  group_by(id) %>%
  summarise(calories = mean(calories, na.rm=TRUE))

 weight_id <- daily_activity_and_weight_log %>%
  group_by(id) %>%
  summarise(weight = mean(weight_pounds, na.rm=TRUE))

 bmi_id <- daily_activity_and_weight_log %>%
  group_by(id) %>%
  summarise(bmi = mean(bmi, na.rm=TRUE))

 df4=data.frame(calories=c(calories_id$calories),
               bmi=c(bmi_id$bmi), 
               weight=c(weight_id$weight)) 
#
# Housekeeping           
x_z = 1:8
```
#### 5.8 Obtain the Start and End Participation Dates
We obtain the start and end survey dates for each participant in the weight_log group.
This will be used to compare the range of total participation days vs. the range of logged weight measurements. 
```{r}
# Get first_appearance and last_appearance. Start again with source data - 'daily_activity'.
# Select id and date and pull out first and last dates.
# Merge with 'total' to pull out only logged weight dates.
# We only want id and date - arrange in asc order.
dfaa <- daily_activity %>%
  select(id, date) %>%
  group_by(id) %>%
  filter(row_number() == 1 | row_number() == n()) 
dfaa <-  merge(dfaa, total, by="id") %>%
  select(id, date, l1) %>%
  arrange(id, date)

### df3 contains first and last dates of recorded weight in long form
# add l1 = id code as factor
df3$l1 <- factor(df3$id, levels = c(df3$id),labels = rep(c(1:8), each=2))
```



### 6 Visualization and Share
Each participant in the survey has a unique ID number. For ease of visualization, each participant's ID
is assigned a reference code number from one to eight. In charts where all participants are visualized, the assigned reference codes range is from 1 to 33.
The reference codes for participants who logged weight data are listed below:
```{r echo=FALSE}
# Create "Code - ID" table and display using kable().
# Stub code for "Weight Entered Manual" table is here too. This will be move to its proper location soon.
Code <- c(1,2,3,4,5,6,7,8)
ID <- c(1503960366, 1927972279, 2873212765, 4319703577, 4558609924, 5577150313, 6962181067, 8877689391)
id_table <- cbind(Code, ID)
#m_a <- c("Manual", "Auto", "Manual", "Manual", "Manual", "Auto", "Manual", "Auto")
#manual_auto <- cbind(ID, m_a)

kable(id_table, align = 'cccc') %>% 
kable_paper(full_width = F) %>%
  column_spec(1, width = "5em") %>%
  column_spec(2, width = "30em")
#, position = "float_left")
#kable(manual_auto, align = 'clc', caption = "<center>Participants who entered weight manually</center>")%>% kable_paper("hover", full_width = F, #position = "right")
```

#### 6.1 General Observations for Participants Providing Weight Measurements
* The following observations were gathered from the charts below:
  + Participants provided data for the entire survey period of 30 days. One participant for 29 days.
  + The group wore their smart devices between 16 to 23 hours a day.
  + Mean weight and BMI was calculated. A normal BMI range is between 18.5 and 24.9 for all adults. 25 to 29 is considered overweight. Above 29, is considered obese. 
    + 4 of 8 participants could be considered overweight. 
    + 1 participant was borderline normal / overweight.
    + One participant was obese and weighted approx 300 pounds with a BMI over 45.
  + Overall change in weight varied between +/- 1.8 pounds except for one participant who recorded an overall weight loss of 4 pounds. Three participants recorded no overall change in weight.
  + Two participants provided weight data for < 80% of the survey period. They also provided weight values for the first and last days of the survey.
  + Three participants provided weight measurements between two and five times. The two participants only once.
* Further analysis will be made on participants 7 and 8, as they provided the most useful weight data. 

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
ggarrange(
ggplot(time_worn_weight_log)  + 
  geom_col(aes(x=l1, y=total_worn),stat="identity", fill="#006699") +
  labs(title = "Total Days in Survey", x= " ", y = "Days") +
    theme(aspect.ratio=8/10),
  
ggplot(time_worn_weight_log)  + 
  geom_col(aes(x=l1, y=total_precents),stat="identity", fill="#006699") +
   geom_hline(yintercept = 16) +
  labs(title = "Hours Device Worn", x= " ", y = "Hours") +
    theme(aspect.ratio=8/10),

ggplot(df4, aes(x=x_z, y=weight))  + 
  geom_bar(stat="identity", fill="#006699",colour="#006699")+
  labs(title= "Weight and BMI", x=" ",y="Weight") +
  geom_point(aes(x=x_z, y=bmi * 10),stat="identity",color="#006000",size=1)+
  geom_hline(yintercept = 18.9 * 10) +
  geom_hline(yintercept = 24.5 * 10) +
  scale_y_continuous(sec.axis=sec_axis(~. /10,name="BMI")) +
  theme(aspect.ratio=9.4/10), 

ggplot(weight_change_id, aes(x=l1, y=weight_changed)) +
  geom_col(fill = "#006699")   +
  geom_hline(yintercept = 0) +
  labs(title = "Change in Weight", x= " ", y = "Weight (lbs)") +
  theme(aspect.ratio=8/10),

ggplot(weight_change_id, aes(x=l1, y=times_weighted$times_weight)) +
  geom_col(fill = "#006699")   +
  geom_hline(yintercept = 1) +
  labs(title = "Days Weighted", x= " ", y = "Days Weighted") +
    theme(aspect.ratio=8/10),

ggplot(weight_change_id, aes(x=l1, y=days)) +
  geom_col(fill = "#006699")   +
  geom_hline(yintercept = 0) +
  labs(title = "Days Between First and\nLast Loggged Weight", x= " ", y = "Days") +
    theme(aspect.ratio=8/10)
)
```

#### 6.2 Average Number of Hours each Participant Wore Smart Device During the Day
The two graphs below indicate participants can be divided into two groups:  
* Group One - Those who wore there smart device > 22 hours.  
* Group Two - Those who wore their smart device between 15 and 19.5 hours.  
We could surmise the second group did not wear their devices while sleeping. This could be confirmed by evaluating sedentary_minutes values (which are related to the minutes a participant's is sleeping). Meditation and other stillness practices could affect both groups.  
The two red dots represent participants 7 and 8. 

```{r echo=FALSE}
# inner join to select only participants with weight data
time_worn_weight_log <- merge(minutes_worn_percents, times_weighted, by=c ("id"))
# housekeeping
x_x = 1:33
x_y = 1:8

# Add x axis participant code label
minutes_worn_percents$l1 <- factor(minutes_worn_percents$id, levels = c(minutes_worn_percents$id),labels = c(1:33))
time_worn_weight_log$l1 <- factor(time_worn_weight_log$id, levels = c(weight_change_id$id),labels = c(1:8))

# highlight in red the two participants of interest in analysis
highlight_df <- minutes_worn_percents %>% 
  filter((total_precents >23.72 & total_precents < 23.75) | (total_precents > 15.82 & total_precents < 15.85))
highlight_df1 <- time_worn_weight_log %>% 
  filter((total_precents >23.72 & total_precents < 23.75) | (total_precents > 15.82 & total_precents < 15.85))
#print(highlight_df)
# plot average time all participants wore their device and average times of those who have weight data
ggarrange(
# plot average time each participant wore the device
ggplot(minutes_worn_percents)  + 
  geom_point(aes(x=l1, y=total_precents),stat="identity", fill="#006699",colour="#006699", size = 3) +
  geom_point(data=highlight_df, aes(x=l1,y=total_precents), color='red', size=3)+
  geom_hline(yintercept = 24) +
   geom_hline(yintercept = 22) +
   geom_hline(yintercept = 19.5) +
   geom_hline(yintercept = 15) +
  ylim(10, 25) +
  labs(title = "All Participants", x= " ", y = "Hours") +
  theme(axis.text.x = element_text(angle = 90, vjust = .45, hjust=1)),

# plot participants average hour  only with weight data
ggplot(time_worn_weight_log)  + 
  geom_point(aes(x=l1, y=total_precents),stat="identity", fill="#006699",colour="#006699", size = 3) +
  geom_point(data=highlight_df1, aes(x=l1,y=total_precents), color='red', size=3)+
  geom_hline(yintercept = 24) +
     geom_hline(yintercept = 22) +
   geom_hline(yintercept = 19.5) +
   geom_hline(yintercept = 15) +
  ylim(10, 25) +
  labs(title = "Weighted Particpants", x= " ", y = " "))
```


#### 6.2.1 Survey Start / End Dates - First / Last Recorded Weight Dates - Number of Weight Measurements
* The following chart plots three important variables:
  + Participant start and end dates - indicated by boxes.
  + First and last dates weight measurement were logged - indicated by dots.
  + Number of weight measurements logged - indicated as a number.  
* This chart indicates only 2 of 8 participants logged consistent weight measurements.   
  
```{r echo=FALSE}
### Print total participation start finish dates as square dot with, 
### Print first and last date for recorded weights as red dot
### Original code stub, updated below...
### ggplot(df3)  + 
###  geom_point(aes(y=date, x=l1),stat="identity", fill="#006699",colour="#006000", size = 3) +
###  labs(title= "Participants Start and End Dates",
###       x="First and Last Recorded Weight (dot)",y="Date") +
###  geom_line(aes(y=date, x=l1),stat="identity", colour="#006699") +
###  geom_point(aes(y=dfaa$date, x=l1), shape = 0 ,stat="identity", fill="#006699",colour="#006699", size = 4)

### Add number times weighted (w_time$times_weight)to chart, left of last weighted date.
### Create new dataset from times_weight(id, times_weight).  
### Since times_weight has 8 rows and df3 has 16 - add_row() for every odd row with a blank row (NA, " ").
###    then fill() NA id column direction = "up".
### Could not get add_row to work with a for loop or as a function(), so hacked manually.
### During cleanup phase will fix.
### library(ggrepel) -- geom_text_repel & geom_label_repel not used.
library(tibble) # for add_row()
library(tidyr) # for fill()

w_time <- times_weighted 
w_time$times_weight <- as.character(w_time$times_weight)
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 8)  
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 7)
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 6) 
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 5) 
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 4) 
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 3) 
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 2) 
w_time <- w_time %>% add_row(id = NA, times_weight = " ", .before = 1)  %>%
  fill(id, .direction = 'up')

### ggplot first and last weighted dates with _point and _line.
### Add number times weighted as _text (nudged left). 
### _point start and end survey dates as box.
ggplot(df3)  + 
    geom_point(aes(y=date, x=l1),stat="identity", fill="#006699",colour="#006000", size = 3) +
    labs(title= " ",
         x=" ",y="Date") +
    geom_line(aes(y=date, x=l1), stat="identity", colour="#006699") +
    geom_text(aes(y=date, x=l1, label = w_time$times_weight), color="red", nudge_x = .35 ,stat="identity")+
    geom_point(aes(y=dfaa$date, x=l1), shape = 0 ,stat="identity", fill="#006699",colour="#006699", size = 4)
```

#### 6.3 Change in Weight vs. Mean Calorie Expenditure and Days Changed Occurred
The following two charts show the mean calorie expenditure and number of days between the first and last recorded weight for each participant. This information is overlayed on the change in weight over survey period. 
An expenditure of 2000 (1600 – 2200) calories a day is considered average for women and 2500 (2200 – 3000) for men.

```{r echo=FALSE}
total <- merge(weight_change_id, calories_id,by="id")
ggarrange(
ggplot(total)  + 
  geom_bar(aes(x=l1, y=weight_changed),stat="identity", fill="#006699",colour="#006699")+
  labs(title= "Total Weight Change vs\n Mean Calories Expended per Day",
       x="Year",y="Weight Change") +
    geom_point(aes(x=l1, y=calories/1000),stat="identity",color="#006000",size=3)+
  geom_hline(yintercept = 2) +
  scale_y_continuous(sec.axis=sec_axis(~.*1000,name="Calories")),
ggplot(total)  + 
  geom_bar(aes(x=l1, y=weight_changed),stat="identity", fill="#006699",colour="#006699")+
  labs(title= "Total Weight Change\n over Recorded Days",
       x="Year",y="Weight Change") +
  geom_point(aes(x=l1, y=days/5),stat="identity",color="#006000",size=3)+
  scale_y_continuous(sec.axis=sec_axis(~.*5,name="Days")))
```

#### 6.4 Daily Calorie Expenditure and Daily Weight
Two participants provided adequate weight data for analysis. Below we visualize:  
- Daily Calorie Expenditure  
- Calorie Summary Statistics  
- Daily Weight  
- Weight Summary Statistics  
From the charts below we can see calories and logged weight varied randomly daily.
Daily calorie expenditure can vary depending on gender, height, age and daily activities.
According to the U.S. Department of Health and Human Services – Average Daily Expenditure:  
- Women – 1600 to 2400  
- Men – 2000 to 3000  
Many studies indicate body weight may vary as much as five pounds during a day.  
From the charts below:  
- We can infer participant 8 is a male and participant 7 is a female.  
- We can also infer the change in weight calculated by subtracting starting weight from end we weight is misleading.  
- We may be able to infer a correlation between calorie expenditure and weight when we look at the trend lines.  
- We cannot infer that either participant lost or gained weight during the survey period.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#ggplot(weight_change_id) +
#  geom_col(aes(x= l1, y= times_weighted$times_weight))


### plot calories and weight for id 8877689391

df=data.frame(id_9=c(daily_activity_and_weight_log$id),
              id_calories=c(daily_activity_and_weight_log$calories), 
  id_weight=c(daily_activity_and_weight_log$weight_pounds))  %>% 
  filter(daily_activity_and_weight_log$id == "8877689391")
  
### plot calories and weight for id 6962181067
df1=data.frame(id_9=c(daily_activity_and_weight_log$id),
              id_calories=c(daily_activity_and_weight_log$calories), 
              id_weight=c(daily_activity_and_weight_log$weight_pounds))  %>% 
 filter(daily_activity_and_weight_log$id == "6962181067")

x_y = c(1:30)
x_x = c(1:24)


#######
# Make functions for each ggplot
gg_7 <- ggplot(df, aes(x= x_x,  y= id_calories)) +
  geom_point() + geom_smooth() +
  geom_hline(yintercept = 2000)+
  geom_hline(yintercept = 3000) +
  labs(x=" ",y=" ") 
ggp_7 <-   ggplot(df, aes(x= x_x,  y= id_weight)) +
  geom_point() + geom_smooth() +
  labs(x="Participant 8",y=" ") 
gg_8 <- ggplot(df1, aes(x= x_y,  y= id_calories)) +
  geom_point() + geom_smooth()+
  geom_hline(yintercept = 1600)+
  geom_hline(yintercept = 2400)+
  labs(x=" ",y=" ") 
ggp_8 <- ggplot(df1, aes(x= x_y,  y= id_weight)) +
  geom_point() + geom_smooth() +
  labs(x="Participant 7",y=" ") 
ggb_7 <-   ggplot(df, aes(x=x_x, y=id_weight)) +  geom_boxplot() + labs(x=" ",y=" ") 
ggb_8 <-   ggplot(df1, aes(x=x_y, y=id_weight)) +  geom_boxplot() + labs(x=" ",y=" ") 
ggc_7 <-   ggplot(df, aes(x=x_x, y=id_calories)) +  geom_boxplot() + labs(x=" ",y=" ") 
ggc_8 <-   ggplot(df1, aes(x=x_y, y=id_calories)) +  geom_boxplot() + labs(x=" ",y=" ") 


# Arrange and annotate plots
figure <- ggarrange(gg_8, ggc_8, ggp_8, ggb_8, gg_7, ggc_7, ggp_7, ggb_7, ncol = 4, nrow = 2)
annotate_figure(figure,
                top = text_grob("Daily Calorie Expenditure and Daily Weight", color = "black", face = "bold", size = 12))
```

#### 6.4.1 Weight Statistics
Additional statistics are provided in table form to add clarity to charts in section 6.4
```{r echo=FALSE}
kable(weight_summary, align = 'rcccc', 
  caption = "<center>Weight Statistics for all Participants</center>")%>% kable_paper("hover", full_width = F, position = "center")%>%
  column_spec(1, width = "5em") %>%
  column_spec(2, width = "10em")%>%
column_spec(3, width = "10em") %>%
column_spec(4, width = "10em") %>%
column_spec(5, width = "10em")%>%
  row_spec(7, background = "#E6E6FA") %>%
   row_spec(8, background = "#E6E6FA")
```


#### 6.5 Weight Recording Method
The dateset weight_log contains a variable: IsManualReport. We assumed this variable identifies whether logged weight data was manually entered or automatically (such as with a digitally enabled scale).  
From the table below we see 5 of 8 participants manually entered weight measurements. Three used another method.
We could not make any correlation between automatically logging weight with more consistent weight logging.

```{r echo=FALSE}
# Create table and display using kable().
# Stub code for "Weight Entered Manual" table is here.
Code <- c(1,2,3,4,5,6,7,8)
#ID <- c(1503960366, 1927972279, 2873212765, 4319703577, 4558609924, 5577150313, 6962181067, 8877689391)
id_table <- cbind(Code, ID)
Manual <- c("true", "false", "true", "true", "true", "false", "true", "false")
Measurements <- c(2, 1, 2, 2, 5, 1,30, 24)
Days_between_first_last <- c(2, 1, 21, 17, 21, 1, 30, 30)
Days_in_Survey <- c(30,30,30,30,30,30,29,30)
manual_auto <- rbind(Code, Manual, Measurements, Days_between_first_last, Days_in_Survey)

#kable(id_table, align = 'clc') %>% 
#kable_paper(full_width = F) %>%
#  column_spec(1, width = "5em") %>%
#  column_spec(2, width = "30em")
#, position = "float_left")
kable(manual_auto, align = 'clc', caption = "<center>Participants who entered weight manually</center>")%>% kable_paper("hover", full_width = F, position = "center")
```

### 7 Summary, Conclusions and Recommendations
According to the Global Wellness Institute, the 2020 global wellness economy is worth $4.4 trillion and is forecast to reach $7 trillion by 2025. The top three wellness industries include:    
• Personal Care & Beauty - 955 billion.  
• Healthy Eating, Nutrition & Weight Loss - 946 billion.  
• Physical Activity - 738 billion.  
  
*Source: Wellness Industry Statistics & Facts [link](https://globalwellnessinstitute.org/press-room/statistics-and-facts/). - The Global Wellness Economy:Country Rankings FEBRUARY 2022 (pdf) [link](https://globalwellnessinstitute.org/wp-content/uploads/2022/02/GWI2022_GlobalWellnessEconomy_CountryRankings_Final.pdf)*

BellaBeat may be able to increase its global market share by including weight monitoring and healthy weight management functionality - integrated into its overall wellness and physical activity products.  
 
In this report, we focused on user survey data from the “FitBit Fitness Tracker” dataset.
We specifically examined the merged “DailyActivity” dataset and the merged “Weight Log” dataset, and focused our analysis on finding insights from the user-logged weight data.  

#### Key Points:

##### 7.1 Participation Insights
33 people participated in the total survey.  
  • 8 of 33 participants (25%) logged body weight data.  
  • Of those, 2 of 8 (25%) provided adequate data for further analysis.  
  • This is 6% of the total survey group.  
We can loosely infer that 25% of participants may have an interest in body weight monitoring. 25% of this subgroup were motivated adequately to log weight consistently.

**It would be helpful for BellaBeats to survey their current customer base to determine if the integration of weight monitoring functionality might be beneficial and for what reasons.** 
  
##### 7.2 Body Weight and BMI Insights
Of the eight participants logging weight data:                                        
   • 4 of 8 (50%) could be considered overweight (according to calculated mean BMI).  
   • 1 of 8 (12.5%)  could be considered borderline overweight.  
   • 1 of 8 (12.5%) was obese.  
We can conclude that 75% of survey group could benefit from a weight monitoring, and weight management program.

**The addition of weight and BMI tracking with weight management functionality may be able to attract more customers to BellaBeat products and increase BellaBeat’s market coverage.**

##### 7.3 Data Logging Consistency Insight
Regarding logging weight data from start to end of the survey period:  
• 3 of 8 (37.5%) of participants logged weight measurements on the start date of the survey.  
• 3 of 8 (37.5%) logged weight measurements on the end date of the survey.  
• Only 2 of 8 (25%) provided weight measurements throughout the full survey period and on the start and end of dates of the survey.  
Regarding the frequency of logged weight data:  
   • 5 of 8 (66.7%) of participants reported manual weight logging.  
   • 2 of 3 (66.7%) participants reported automated weight logging, but only logged one measurement.  
   • Manual / automated logging was evenly spread between the two participants who provided the most samples.
No correlation can be made regarding the use of manual vs. automated logging. User motivation may have been a determinate factor. It also could be a survey design issue. Additional, we don’t know if automated weight logging was available to all participants.  
 
**It would be very important for BellaBeat developers to partner with smart scale and smart weight measurement manufacturers. This will help streamline the data logging process for customers and increase logged weight data. This should be a highlighted feature to help entice users to choose BellaBeat products.**

##### 7.4 Change in Weight vs. Calorie Expenditure Insights.
No meaningful insights could be determined from the logged weight data and recorded calorie expenditure. The provided datasets were too small and additionally hampered by limited user participation. Gender and Age information, important variables, was also not provided.  
 
#### Conclusions   
**It will be very helpful for BellaBeat to design and implement a more inclusive survey to best capture needed variables and should strive to obtain data from a much larger sample group. The sample demographics should include people of varying activity levels and varied weight management needs and goals.  
It will also be helpful to survey existing customers and non-BellaBeat customers, to determine the type of weight management features that would best meet their weight management goals.**
  
    
       
         
           
             
               
                 
                 








 

